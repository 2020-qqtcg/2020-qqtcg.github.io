<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>计算机网络（网络层） | 划水摸鱼</title><meta name="keywords" content="计网,笔记"><meta name="author" content="jianjian"><meta name="copyright" content="jianjian"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="网络层服务概述从发送主机向接收传送数据段 发送主机：将数据封装到数据包中 接收主机：向传输层交付数据段 每个主机和路由器都运行网络层协议 路由器检验所有穿越它的$IP$数据报的头部域，决策如何处理$IP$数据报  网络层的核心功能转发（forwarding）：将分组从路由器的输入端口转移到合适的输出端口 路由（routing）：确定分组从源到目的的经过的路径  路由算法   某些网络的重要功能—连">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络（网络层）">
<meta property="og:url" content="https://mujian.work/2022/05/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%89/index.html">
<meta property="og:site_name" content="划水摸鱼">
<meta property="og:description" content="网络层服务概述从发送主机向接收传送数据段 发送主机：将数据封装到数据包中 接收主机：向传输层交付数据段 每个主机和路由器都运行网络层协议 路由器检验所有穿越它的$IP$数据报的头部域，决策如何处理$IP$数据报  网络层的核心功能转发（forwarding）：将分组从路由器的输入端口转移到合适的输出端口 路由（routing）：确定分组从源到目的的经过的路径  路由算法   某些网络的重要功能—连">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/05/14/ql1w5dKJmnY3irH.png">
<meta property="article:published_time" content="2022-05-14T01:57:05.000Z">
<meta property="article:modified_time" content="2022-05-26T15:54:15.124Z">
<meta property="article:author" content="jianjian">
<meta property="article:tag" content="计网">
<meta property="article:tag" content="笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/05/14/ql1w5dKJmnY3irH.png"><link rel="shortcut icon" href="https://s2.loli.net/2022/04/19/pm7NeZBgDW3VJIP.png"><link rel="canonical" href="https://mujian.work/2022/05/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%89/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":600},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '计算机网络（网络层）',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-05-26 23:54:15'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://s2.loli.net/2022/04/19/dkPLexUuNBIclp4.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">30</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">17</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/05/14/ql1w5dKJmnY3irH.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">划水摸鱼</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">计算机网络（网络层）</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-05-14T01:57:05.000Z" title="发表于 2022-05-14 09:57:05">2022-05-14</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-05-26T15:54:15.124Z" title="更新于 2022-05-26 23:54:15">2022-05-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AE%A1%E7%BD%91/">计网</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="计算机网络（网络层）"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="网络层服务"><a href="#网络层服务" class="headerlink" title="网络层服务"></a>网络层服务</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>从发送主机向接收传送数据段</p>
<p>发送主机：将数据封装到数据包中</p>
<p>接收主机：向传输层交付数据段</p>
<p>每个主机和路由器都运行网络层协议</p>
<p>路由器检验所有穿越它的$IP$数据报的头部域，决策如何处理$IP$数据报</p>
<p><img src="https://s2.loli.net/2022/05/14/MykZmw7OQbTC58H.png" alt="image-20220514101921975"></p>
<h2 id="网络层的核心功能"><a href="#网络层的核心功能" class="headerlink" title="网络层的核心功能"></a>网络层的核心功能</h2><p><strong>转发（forwarding）</strong>：将分组从路由器的输入端口转移到合适的输出端口</p>
<p><strong>路由（routing）</strong>：确定分组从源到目的的经过的路径</p>
<ul>
<li>路由算法</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/14/3mMdjnC6qrQSyov.png" alt="image-20220514102253436"></p>
<p>某些网络的重要功能—<strong>连接建立</strong></p>
<ul>
<li>数据分组传输之前两端主机需要首先建立虚拟/逻辑连接，网络设备（如路由器）参与连接的建立</li>
<li>不同于传输层的两个应用进程之间，对中间网络设备透明，网络连接是两个主机之间，路径上的路由器等网络设备参与其中的</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/14/8wId1HhAn4P2StL.png" alt="image-20220514102424876"></p>
<h2 id="网络层服务模型"><a href="#网络层服务模型" class="headerlink" title="网络层服务模型"></a>网络层服务模型</h2><p><img src="https://s2.loli.net/2022/05/14/Qxu8bDeIamMGq4s.png" alt="image-20220514102719165"></p>
<p><strong>无连接服务</strong>：不事先为系列分组的传输确定传输路径，每个分组独立确定传输路径，不同分组可能传输路径不同</p>
<ul>
<li>数据报网络：简化网络，复杂“边缘”</li>
</ul>
<p><strong>连接服务</strong>：首先为系列分组的传输确定从源到目的经过的路径，然后沿该路径传输系列分组，系列分组传输路径相同</p>
<ul>
<li>虚电路网络：简化“边缘”，复杂网络</li>
</ul>
<h1 id="虚电路网络"><a href="#虚电路网络" class="headerlink" title="虚电路网络"></a>虚电路网络</h1><h2 id="虚电路（-VC-）"><a href="#虚电路（-VC-）" class="headerlink" title="虚电路（$VC$）"></a>虚电路（$VC$）</h2><p><img src="https://s2.loli.net/2022/05/14/bytYEdQkiVJKCGO.png" alt="image-20220514104303691"></p>
<p>一条从源主机到目的主机，类似于电路的逻辑（逻辑连接）</p>
<ul>
<li>分组交换</li>
<li>每个分组的传输利用链路的全部带宽（不同于电路交换的复用）</li>
<li>源到目的路径经过的网络层设备共同完成虚电路网络功能</li>
<li>通信过程<ul>
<li>呼叫建立 、数据传输、拆除呼叫</li>
</ul>
</li>
<li>每个分组携带虚电路标识$VCID$，而不是目的地址</li>
<li>虚电路经过的每个网络设备都需要维护它的连接状态</li>
<li>链路、网络设备资源（如带宽、缓存）可以面向$VC$进行预分配来达到一些预期的服务性能</li>
</ul>
<h2 id="VC-的具体实现"><a href="#VC-的具体实现" class="headerlink" title="$VC$的具体实现"></a>$VC$的具体实现</h2><p>每条虚电路包括：</p>
<ul>
<li>从源主机到目的主机的一条路径</li>
<li>虚电路号$VCID$，沿路每段链路一个编号。（$VCID$反映链路的通信能力，不同链路的通信能力不同，$VCID$也不能相同）</li>
<li>沿路每个网络层设备，利用转发表记录经过的每条虚电路</li>
</ul>
<blockquote>
<p>同一条$VC$，在每段连路上的$VCID$通常不同，路由器转发分组是依据转发表改写/替换虚电路号</p>
</blockquote>
<p><img src="https://s2.loli.net/2022/05/14/eKWSnJBR1QAsqMl.png" alt="image-20220514105624317"></p>
<h2 id="虚电路信令协议"><a href="#虚电路信令协议" class="headerlink" title="虚电路信令协议"></a>虚电路信令协议</h2><p>$（signaling protocols）$</p>
<p>用于$VC$的建立、维护与拆除，建立过程中路由选择</p>
<p>典型的虚电路网络：ATM、帧中继（frame-relay）网络</p>
<p><img src="https://s2.loli.net/2022/05/14/pxaVhKG3fDmtroX.png" alt="image-20220514110009500"></p>
<h1 id="数据报网络"><a href="#数据报网络" class="headerlink" title="数据报网络"></a>数据报网络</h1><p>无连接</p>
<p>每个分组携带目的地址</p>
<p>路由器根据分组的目的地址转发分组</p>
<ul>
<li>基于路由协议/算法构建转发表</li>
<li>检索转发表</li>
<li>每个分组独立选路</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/14/ql1w5dKJmnY3irH.png" alt="image-20220514135740175"></p>
<h2 id="数据报转发表"><a href="#数据报转发表" class="headerlink" title="数据报转发表"></a>数据报转发表</h2><p>如果转发表的目的地址都是具体地址，则数量太过庞大，很难实现，所以转发表中存储目的地址</p>
<p><img src="https://s2.loli.net/2022/05/14/gV3FTYhrxB1AaHm.png" alt="image-20220514140008397"></p>
<p><img src="https://s2.loli.net/2022/05/14/16JNt5WSFXiEGUe.png" alt="image-20220514140116788"></p>
<p>如果划分不那么完美</p>
<p><strong>最长前缀匹配优先</strong>：优先选择与分组目的地址匹配前缀最长的入口</p>
<p><img src="https://s2.loli.net/2022/05/14/QFI3Z7flxWa8TXJ.png" alt="image-20220514140813726"></p>
<h1 id="Internet网络层"><a href="#Internet网络层" class="headerlink" title="Internet网络层"></a>Internet网络层</h1><p><img src="https://s2.loli.net/2022/05/14/bVQMCLaz6KZW8Nk.png" alt="image-20220514195138327"></p>
<p>一般来说，实现$IP$协议也要同时实现$ICMP$协议</p>
<h1 id="ARP地址解析协议"><a href="#ARP地址解析协议" class="headerlink" title="ARP地址解析协议"></a>ARP地址解析协议</h1><p><img src="https://s2.loli.net/2022/05/26/1uqZxjBALctS5Th.png" alt="image-20220526230525207"></p>
<p>ARP表：在LAN中的每一个IP节点维护一个表，存储LAN节点的IP/MAC地址映射关系</p>
<ul>
<li><IP地址；MAC地址；TTL></li>
<li>TTL：经过这个时间以后该映射关系会被遗弃，典型值为20min</li>
</ul>
<p>通过ARP表在已知目的接口IP地址的前提下确认其MAC地址</p>
<blockquote>
<ol>
<li>ARP 进程在本局域网上广播发送一个ARP 请求分组（具体格式可参阅[COME06] 的第23 章）。图4-ll(a)是主机A <strong>广播</strong>发送ARP 请求分组的示意图。ARP 请求分组的主要内容是：“我的IP 地址是209.0.0.5, 硬件地址是00-00-C0-15-AD-18 。我想知道IP 地址为209.0.0.6 的主机的硬件地址。”<ul>
<li>广播MAC地址为全1</li>
</ul>
</li>
<li>在本局域网上的所有主机上运行的ARP 进程都收到此ARP 请求分组。</li>
<li>主机B 的IP 地址与ARP 请求分组中要查询的IP 地址一致，就收下这个ARP 请求分组，并向主机A 发送ARP 响应分组（其格式见[COME06]), 同时在这个ARP 响应分组中写入自己的硬件地址。由千其余的所有主机的IP 地址都与ARP 请求分组中要查询的IP 地址不一致，因此都不理睬这个ARP 请求分组，见图4-ll(b) 。ARP 响应分组的主要内容是：“我的IP 地址是209.0.0.6, 我的硬件地址是08-00-2B-OO-EE-OA 。”请注意：虽然ARP 请求分组是广播发送的，但ARP 响应分组是普通的单播，即从一个源地址发送到一个目的地址。</li>
</ol>
<p><img src="https://s2.loli.net/2022/05/26/Y9FHo54cEhR3VpU.png" alt="image-20220526231957077"></p>
<ol>
<li>主机A 收到主机B 的ARP 响应分组后，就在其ARP 高速缓存中写入主机B 的IP地址到硬件地址的映射。</li>
</ol>
<p>当主机A 向B 发送数据报时，很可能以后不久主机B 还要向A 发送数据报，因而主机B 也可能要向A 发送ARP 请求分组。为了减少网络上的通信量，主机A 在发送其ARP 请求分组时，就把自己的IP 地址到硬件地址的映射写入ARP 请求分组。当主机B 收到A 的ARP 请求分组时，就把主机A 的这一地址映射写入主机B 自己的ARP 高速缓存中。以后主机B 向A 发送数据报时就很方便了。</p>
</blockquote>
<p>从一个LAN路由到另一个LAN路由，发给LAN内的网关。</p>
<p><img src="https://s2.loli.net/2022/05/26/GbJmqO4pgHCSlsX.png" alt="image-20220526235314515"></p>
<h1 id="IP"><a href="#IP" class="headerlink" title="$IP$"></a>$IP$</h1><h2 id="IP-数据报"><a href="#IP-数据报" class="headerlink" title="$IP$数据报"></a>$IP$数据报</h2><h3 id="格式"><a href="#格式" class="headerlink" title="格式"></a>格式</h3><p><img src="https://s2.loli.net/2022/05/14/rCbXiyslv9mhjxw.png" alt="image-20220514195454615"></p>
<ul>
<li><p><strong>版本号</strong>，占4位</p>
</li>
<li><p><strong>首部长度</strong>占4位：$IP$分组首部长度</p>
<ul>
<li>以4字节为单位，乘以4才是首部长度，例如首部长度字段为5，则表示$IP$首部长度为20字节</li>
</ul>
</li>
<li><p>$TOS$占8位：指示期望获得哪种类型的服务，也叫区分服务，只有在网络提供区分服务时使用，一般情况下不使用</p>
</li>
<li><p><strong>总长度</strong>：$IP$分组的总字节数（首部+数据）</p>
<ul>
<li>最大$IP$分组的总长度：$65535B$</li>
<li>最小的$IP$分组首部$20B$</li>
<li>$IP$分组可以封装的最大数据为$65535 - 20 = 65515B$</li>
</ul>
</li>
<li><p><strong>标识$ID$</strong>：标识一个$IP$分组</p>
<ul>
<li>$IP$协议利用一个计数器，每产生一个$IP$分组计数器加1，作为该$IP$分组的标识</li>
<li>标识不足以唯一标识一个$IP$分组，还需要利用源、目的$IP$地址等才能唯一标识一个$IP$分组</li>
</ul>
</li>
<li><p><strong>标志位</strong>：</p>
<ul>
<li><p>| 保留 | $DF$ | $MF$ |<br>| —— | —— | —— |</p>
</li>
<li><p>$DF(Don’t Fragment)$： 为1禁止分片，为0允许分片</p>
</li>
<li><p>$MF(More Fragment)$：为1表示非最后一片，为0表示最后一片（或未分片）</p>
</li>
</ul>
</li>
<li><p><strong>片偏移</strong>：一个$IP$分组分片封装原$IP$分组数据的相对偏移量</p>
<ul>
<li>以8字节为单位</li>
</ul>
</li>
<li><p>$TTL$：$IP$分组在网络中可以通过的路由器数（或跳步数），路由器转发一次分组$TTL$减1，如果$TTL=0$，路由器则丢弃该$IP$分组</p>
</li>
<li><p><strong>协议</strong>：指示$IP$分组封装的是哪个协议的数据包</p>
<ul>
<li>可以实现复用/分解；例如6表示封装的是$TCP$段，17位表示封装的是$UDP$段</li>
</ul>
</li>
<li><p><strong>首部校验和</strong>：实现对$IP$分组首部的差错检测</p>
<ul>
<li>计算校验和时该字段全置为0，采用反码算数运算求和，和的反码作为首部校验和字段</li>
<li>逐跳计算，逐跳校验：因为每次转发首部都会发生变化，例如$TTL$每次转发都会减1</li>
</ul>
</li>
<li><p><strong>选项字段</strong>：$1$~$40B$，携带安全、源选路径、时间戳和路由记录等内容，实际上很少被使用</p>
</li>
<li><p><strong>填充</strong>：$0$~$3B$，目的是补齐整个首部，符合32位对齐，保证首部长度是4字节的倍数</p>
</li>
</ul>
<h3 id="IP分片"><a href="#IP分片" class="headerlink" title="$IP分片$"></a>$IP分片$</h3><p><strong>最大传输单元$MTU$</strong>：链路层数据帧可封装数据的上限</p>
<p>不同链路的$MTU$不同</p>
<p><img src="https://s2.loli.net/2022/05/14/KeGI3TtlMiw5grz.png" alt="image-20220514202648427"></p>
<p>当两条链路$MTU$不一样时，可能会发生大的向小的传输的情况</p>
<p><img src="https://s2.loli.net/2022/05/14/ocIDwKmu54QxykB.png" alt="image-20220514202824541"></p>
<p>大的$IP$分组向较小的$MTU$链路转发时，<strong>可以</strong>被分片（如果不允许分片路由器会选择将分组丢掉）</p>
<ul>
<li><p>1个$IP$分组分为多片$IP$分组</p>
</li>
<li><p>$IP$分片到达目的主机后进行“重组”</p>
</li>
</ul>
<p>$IP$首部相关字段用于标识分片以及确定分片的相对顺序（字段描述见<strong>格式</strong>部分）</p>
<p>（如果目的主机没有收全，会等待一段时间后将所有分组都丢弃）</p>
<p><img src="https://s2.loli.net/2022/05/14/2ce83zXgkroUp6F.png" alt="image-20220514203341102"></p>
<p><strong>过程</strong>（$IP$分组总长度为$L$，待穿法链路的$MTU$为$M$，$L &gt; M$）</p>
<ul>
<li><p>$DF = 0$</p>
</li>
<li><p>分片时每个分片的标识复制原$IP$分组的标识</p>
</li>
<li><p>通常分片时，除最后一个分片，其他分片均分为$MTU$允许的最大分片</p>
</li>
<li><p>一个最大分片可封装的数据应该是8的倍数，因此，一个最大分片可封装的数据为：</p>
<script type="math/tex; mode=display">d =  \lfloor \frac{M-20}{8} \rfloor \times 8</script></li>
<li><p>需要的总片数为：</p>
<script type="math/tex; mode=display">n =  \lceil \frac{L-20}{d} \rceil</script></li>
<li><p><img src="https://s2.loli.net/2022/05/14/lP6d8FcIH4OtL7u.png" alt="image-20220514210104710"></p>
</li>
</ul>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/14/JMD4cewqLfy7VFE.png" alt="image-20220514210310269"></p>
</blockquote>
<h2 id="IP-编址"><a href="#IP-编址" class="headerlink" title="$IP$编址"></a>$IP$编址</h2><p><img src="https://s2.loli.net/2022/05/15/GQDBj7zqH9aVPwZ.png" alt="image-20220515145425732"></p>
<p><strong>接口</strong>：主机/路由器与物理链路的连接</p>
<ul>
<li>实现网络层功能</li>
<li>路由器通常有多个接口</li>
<li>主机通常只有一个或两个接口</li>
</ul>
<p>$IP$地址：32比特（$IPv4$）</p>
<ul>
<li>标识主机、路由器的接口</li>
<li>$IP$地址与每个接口关联</li>
</ul>
<p>（点分十进制）</p>
<p><img src="https://s2.loli.net/2022/05/15/M3dXPveC6g2s5yt.png" alt="image-20220515145306495"></p>
<p>$IP$地址：</p>
<ul>
<li><p>网络号—高位比特</p>
</li>
<li><p>主机号—低位比特</p>
</li>
<li><p>| $NetID$ | $HostID$ |<br>| ———- | ———— |</p>
</li>
</ul>
<p>$IP$子网：</p>
<ul>
<li>$IP$地址具有相同网络号的设备接口</li>
<li>不跨越路由器（第三以及上层网络设备）可以彼此物理联通的接口</li>
</ul>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/15/8ir3eVHSOozBTnx.png" alt="image-20220515145922892"></p>
<p>6</p>
</blockquote>
<h2 id="有类-IP-地址"><a href="#有类-IP-地址" class="headerlink" title="有类$IP$地址"></a>有类$IP$地址</h2><p><img src="https://s2.loli.net/2022/05/15/35ILjNbOfTvrVgi.png" alt="image-20220515150635027"></p>
<ul>
<li>A 类、B 类和C 类地址的网络号字段（在图中这个字段是灰色的）分别为1 个、2 个和3 个字节长，而在网络号字段的最前面有1~3 位的类别位，其数值分别规定为0, 10 和110 。</li>
<li>A 类、B 类和C 类地址的主机号字段分别为3 个、2 个和1 个字节长。</li>
<li>D 类地址（前4 位是1110) 用于多播（一对多通信）。</li>
<li>E 类地址（前4 位是1111) 保留为以后用。</li>
</ul>
<blockquote>
<p>B类网络可以指派的最小网络地址是128.1.00</p>
<p>C类网络可以指派的最小网络地址是192.0.1.0</p>
<p>特殊$IP$地址</p>
<p><img src="https://s2.loli.net/2022/05/15/sPuEMXvIQF8aOng.png" alt="image-20220515151023875"></p>
<blockquote>
<p>全0用于在自身主机不知道自身的$IP$但仍然要传播分组的时候，一个例子是$DHCP$的工作过程</p>
</blockquote>
<p>==xxr书上第二行是可以、不可以，从后面的ppt来看，xxr是对的==</p>
<p>私有$IP$地址</p>
<p><img src="https://s2.loli.net/2022/05/15/aCflSnWZADceTwL.png" alt="image-20220515151730256"></p>
</blockquote>
<h1 id="子网划分与子网掩码"><a href="#子网划分与子网掩码" class="headerlink" title="子网划分与子网掩码"></a>子网划分与子网掩码</h1><p>将$IP$子网划分为更小范围的子网</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>$NetID$</th>
<th>$SubID$</th>
<th>$HostID$</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>$SubID$原主机号部分比特</li>
</ul>
<p><strong>子网掩码</strong></p>
<ul>
<li>形如$IP$地址，点分十进制形式</li>
<li>对应$NetID、SubID$位取1，$HostID$位取0</li>
</ul>
<p><strong>子网掩码+子网划分确定子网的大小</strong></p>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/15/vPXj3yKr8hFdai9.png" alt="image-20220515154549309"></p>
</blockquote>
<p><strong>将$IP$分组的目的$IP$地址与子网掩码按位与运算，提取子网地址</strong></p>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/15/JF4HCw9NLV5EAxn.png" alt="image-20220515154851346"></p>
<p>一个C类地址的划分例子</p>
<p><img src="https://s2.loli.net/2022/05/15/SwiVqlPujNQanxf.png" alt="image-20220515155122253"></p>
</blockquote>
<h1 id="CIDR-与路由聚合"><a href="#CIDR-与路由聚合" class="headerlink" title="$CIDR$与路由聚合"></a>$CIDR$与路由聚合</h1><p><strong>无类域间路由</strong>（$Classless InterDomain Routing$）</p>
<ul>
<li>消除了有类地址的界限</li>
<li>把网络号+子网号统一为一个可以任意长度的前缀</li>
<li>融合子网地址与子网掩码，方便子网划分<ul>
<li>$a.b.c.d/x$，其中$x$为前缀长度</li>
</ul>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/15/65zDP2wbQYkjAFG.png" alt="image-20220515155612619"></p>
<ul>
<li><p>提高$IPv4$地址空间分配效率</p>
</li>
<li><p>提高路由效率</p>
<ul>
<li><p>将多个子网聚合为一个较大的子网</p>
</li>
<li><p>构造超网（一个较大的子网）</p>
</li>
</ul>
</li>
</ul>
<p><strong>路由聚合</strong>（$route aggregation$）：面对较大的子网记录转发信息，节省路由表，提高路由效率</p>
<p><img src="https://s2.loli.net/2022/05/15/1Ap3L5gan9mzyeh.png" alt="image-20220515160323007"></p>
<p>层级编制使得路由器信息通知更高效：</p>
<p><img src="https://s2.loli.net/2022/05/15/riTh1OWMq8ylYFS.png" alt="image-20220515160540388"></p>
<p>地址不一定连续，聚合的子网中有可能会缺少一部分，此时要在路由器中添加缺少的部分，利用最长前缀匹配正确转发</p>
<p><img src="https://s2.loli.net/2022/05/15/LXwK5YMAUoVxGsE.png" alt="image-20220515160716438"></p>
<h1 id="网络地址转换-NAT"><a href="#网络地址转换-NAT" class="headerlink" title="网络地址转换$NAT$"></a>网络地址转换$NAT$</h1><p>使用私有地址的主机要进行通信必须要进行地址转换</p>
<p><img src="https://s2.loli.net/2022/05/15/e9EZ8v6abSnCGzq.png" alt="image-20220515170040774"></p>
<h2 id="动机"><a href="#动机" class="headerlink" title="动机"></a>动机</h2><ul>
<li>只需/能从$ISP$申请一个$IP$地址<ul>
<li>$IPv4$地址耗尽</li>
</ul>
</li>
<li>本地网络设备$IP$地址的变更，无需通知外界网络</li>
<li>变更$ISP$时，无需修改内部网络设备$IP$</li>
<li>内部网络设备对外部网络不可见，即不可直接寻址（安全）</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p><strong>替换</strong></p>
<ul>
<li>利用（$NAT \space IP$ 地址，新端口号）替换每个外出$IP$数据报的（源$IP$地址，源端口号）</li>
</ul>
<p><strong>记录</strong></p>
<ul>
<li>将每对（$NAT \space IP$ 地址，新端口号）与（源$IP$地址，源端口号）的替换信息存储到$NAT$转换表中</li>
</ul>
<p><strong>替换</strong></p>
<ul>
<li>根据$NAT$转换表，利用（源$IP$地址，源端口号）替换每个进入内网$IP$数据报的（目的$IP$地址，目的端口号），即（$NAT \space IP$ 地址，新端口号）</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/15/WMaRV6JnFU93k4w.png" alt="image-20220515170912616"></p>
<p>16比特的端口号字段可以同时支持60000多并行连接</p>
<blockquote>
<p>主要争议：</p>
<ul>
<li>路由器应该只处理第三层功能</li>
<li>违背端到端通信原则<ul>
<li>应用开发者必须考虑到$NAT$的存在，例如$P2P$应用</li>
</ul>
</li>
<li>地址短缺问题应该有$IPv6$来解决</li>
</ul>
</blockquote>
<h2 id="NAT-穿透问题"><a href="#NAT-穿透问题" class="headerlink" title="$NAT$穿透问题"></a>$NAT$穿透问题</h2><p><img src="https://s2.loli.net/2022/05/15/dk7CQi3nfasmYN1.png" alt="image-20220515193553214"></p>
<ul>
<li><p>静态配置$NAT$，将特定端口的连接请求转发给服务器</p>
</li>
<li><p>利用$UPnP$互联网网关设备协议自动配置</p>
<p><img src="https://s2.loli.net/2022/05/15/mai1KIAdob8zJPU.png" alt="image-20220515193738362"></p>
<ul>
<li>学习到$NAT$公共$IP$地址</li>
<li>在$NAT$转换表中，增删端口映射</li>
</ul>
</li>
<li><p>中继（如$Skype$）</p>
<ul>
<li>$NAT$内部的客户与中继服务器建立连接</li>
<li>外部客户也与中继服务器建立连接</li>
<li>中继服务器桥接两个连接的分组</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/15/JX35eC72xh8Y4Dn.png" alt="image-20220515194119521"></p>
</li>
</ul>
<h1 id="ICMP"><a href="#ICMP" class="headerlink" title="$ICMP$"></a>$ICMP$</h1><h2 id="报文种类"><a href="#报文种类" class="headerlink" title="报文种类"></a>报文种类</h2><p>（互联网控制报文协议）</p>
<p>支持主机和路由器：</p>
<ul>
<li>差错报告</li>
<li>网络探询</li>
</ul>
<p>两类报文：</p>
<ul>
<li>差错报告报文（5种）<ul>
<li><strong>目的不可达</strong></li>
<li><strong>源抑制</strong>（当路由器发现自身缓存已满导致后续报文被丢弃，向源主机发送该报文，期望源主机降低发送速率）</li>
<li><strong>超时/超期</strong>（$TTL$）</li>
<li><strong>参数问题</strong>（路由器认为首部参数有问题而丢弃）</li>
<li><strong>重定向</strong>（路由器认为数据报不应该由自己来转发）</li>
</ul>
</li>
<li>网络探询报文（2组）<ul>
<li>回声（$Echo$）请求与应答报文（$Reply$）<ul>
<li>ping利用该种报文</li>
</ul>
</li>
<li>时间戳请求与应答报文</li>
</ul>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/16/qiehAL9HRtM5Jpr.png" alt="image-20220516144352888"></p>
<blockquote>
<p>几种不发送$ICMP$差错报告报文的特殊情况</p>
<ul>
<li>对$ICMP$差错报告报文不在发送$ICMP$差错报告报文</li>
<li>除了第一个$IP$数据分片以外，对后续分片均不发送</li>
<li>多播$IP$数据报不发送</li>
<li>对具有特殊地址（如$127.0.0.1或0.0.0.0$）的$IP$数据报不发送</li>
</ul>
<p>几种$ICMP$报文已不再使用</p>
<ul>
<li>信息请求与应答报文</li>
<li>子网掩码请求与应答报文</li>
<li>路由器询问和通告报文</li>
</ul>
</blockquote>
<h2 id="报文格式"><a href="#报文格式" class="headerlink" title="报文格式"></a>报文格式</h2><p>$ICMP$报文封装到$IP$数据报中传输</p>
<p><img src="https://s2.loli.net/2022/05/16/fEb1wk9YrQqApHn.png" alt="image-20220516145610769"></p>
<h2 id="差错报告报文数据封装"><a href="#差错报告报文数据封装" class="headerlink" title="差错报告报文数据封装"></a>差错报告报文数据封装</h2><p><img src="https://s2.loli.net/2022/05/16/o5ZB9mkaOLd6sPM.png" alt="image-20220516145817854"></p>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>$Traceroute$</p>
<p><img src="https://s2.loli.net/2022/05/16/KbFTvqBHaWkM8rm.png" alt="image-20220516150354675"></p>
<h1 id="IPv6"><a href="#IPv6" class="headerlink" title="$IPv6$"></a>$IPv6$</h1><h2 id="动机-1"><a href="#动机-1" class="headerlink" title="动机"></a>动机</h2><ul>
<li>$IPv4$地址空间已分配殆尽</li>
<li>改进首部格式<ul>
<li>快速处理/转发数据报</li>
<li>支持$QoS$</li>
</ul>
</li>
</ul>
<h2 id="格式-1"><a href="#格式-1" class="headerlink" title="格式"></a>格式</h2><p>$IPv6$数据报格式：</p>
<ul>
<li>固定长度的40字节基本首部</li>
<li>不允许分片</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/16/iHGwcvEUfRKjZN7.png" alt="image-20220516150701480"></p>
<ul>
<li>优先级（priority）：标识数据报的优先级</li>
<li>流标签（flow Label）：标识同一“流”中的数据报</li>
<li>下一个首部：标识下一个首部，最后一个首部指向上层协议首部（如TCP首部）</li>
</ul>
<h2 id="改变"><a href="#改变" class="headerlink" title="改变"></a>改变</h2><p>校验和被彻底移除，以减少每跳处理时间</p>
<p>选项机制改变，定义多个选项首部，通过“下一个首部”字段指示</p>
<p>$ICMPv6$：新版$ICMP$</p>
<ul>
<li>附加报文类型，例如“$Packet \space Too \space Big$”</li>
<li>多播组管理功能</li>
</ul>
<h2 id="基本地址类型"><a href="#基本地址类型" class="headerlink" title="基本地址类型"></a>基本地址类型</h2><p>地址表现形式（8组，每组4位16进制数1）</p>
<p><img src="https://s2.loli.net/2022/05/16/coVQhULj9qKDnTO.png" alt="image-20220516151920930"></p>
<p>不在有广播地址，定义为特殊的多播</p>
<p><img src="https://s2.loli.net/2022/05/16/g3LOViYEdc6TfP7.png" alt="image-20220516152218520"></p>
<h2 id="过渡"><a href="#过渡" class="headerlink" title="过渡"></a>过渡</h2><p><strong>隧道（tunneling）</strong>：$IPv6$数据报作为$IPv4$数据报的载荷进行封装，穿越$IPv4$网络</p>
<p><img src="https://s2.loli.net/2022/05/16/Gd4FzJgQYSbAqKo.png" alt="image-20220516152435153"></p>
<p><img src="https://s2.loli.net/2022/05/16/uE8BreAfgLHtXbF.png" alt="image-20220516152551893"></p>
<h1 id="路由算法"><a href="#路由算法" class="headerlink" title="路由算法"></a>路由算法</h1><p><img src="https://s2.loli.net/2022/05/16/BkYXuMhZLDbJsx8.png" alt="image-20220516163659866"></p>
<p><strong>网络抽象：图</strong></p>
<p><img src="https://s2.loli.net/2022/05/16/Rj7wZxfyokUltdI.png" alt="image-20220516163838518"></p>
<p><img src="https://s2.loli.net/2022/05/16/nvUfX1ba8sdLI94.png" alt="image-20220516164050140"></p>
<p><strong>关键问题：源到目的的最小费用路径是什么</strong></p>
<p><strong>路由算法：寻找最小费用路径的算法</strong></p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p><strong>静态路由：</strong></p>
<ul>
<li>手工配置</li>
<li>路由更新慢，需要人工改动</li>
<li>优先级高</li>
</ul>
<p><strong>动态路由：</strong></p>
<ul>
<li>路由更新快<ul>
<li>定期更新</li>
<li>即是响应链路费用或网络拓扑变化</li>
</ul>
</li>
</ul>
<p><strong>全局信息：</strong></p>
<ul>
<li>所有路由器掌握完整的网络拓扑和链路费用信息<ul>
<li>链路状态$LS$路由算法</li>
</ul>
</li>
</ul>
<p><strong>分散信息：</strong></p>
<ul>
<li>路由器只掌握物理相连的邻居以及链路费用</li>
<li>邻居间信息交换、运算的迭代过程<ul>
<li>距离向量（$DV$）路由算法</li>
</ul>
</li>
</ul>
<h2 id="链路状态路由算法"><a href="#链路状态路由算法" class="headerlink" title="链路状态路由算法"></a>链路状态路由算法</h2><p>$Dijkstra$算法</p>
<ul>
<li><p>所有结点掌握网络拓扑和链路费用</p>
<ul>
<li>通过“链路状态广播”</li>
<li>所有结点拥有相同信息</li>
</ul>
</li>
<li><p>计算从一个结点到达所有其它结点的最短路径，获得该结点的转发表</p>
</li>
<li><p>迭代：k次迭代后得到到达k个目的节点的最短路径</p>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/16/gkTwyChnA1Lqzdx.png" alt="image-20220516170349019"></p>
<blockquote>
<p>存在震荡可能</p>
<p><img src="https://s2.loli.net/2022/05/16/zKWXFOLcY1ytSfb.png" alt="image-20220516170556979"></p>
<p>往往会采取一些措施避免例如随机延迟的链路状态更新</p>
</blockquote>
<h2 id="距离向量算法"><a href="#距离向量算法" class="headerlink" title="距离向量算法"></a>距离向量算法</h2><p>（$Distance \space Vector$）</p>
<p>$Bellman-Ford$方程（动态规划）</p>
<p><img src="https://s2.loli.net/2022/05/18/pHvA3WhgqtQLJnr.png" alt="image-20220518134727006"></p>
<p><img src="https://s2.loli.net/2022/05/18/6FOxW2Q5fI8gjcJ.png" alt="image-20220518135143645"></p>
<p>   <img src="https://s2.loli.net/2022/05/18/wJmhaUQfOD6zX4i.png" alt="image-20220518135444116"></p>
<p><img src="https://s2.loli.net/2022/05/18/IVrnmCOxJ9efRdu.png" alt="image-20220518135801510"></p>
<blockquote>
<p><strong>举例</strong></p>
<p><img src="https://s2.loli.net/2022/05/18/nTIkGD7EqrdgFcu.png" alt="image-20220518140233316"></p>
<p>第二列的（x，z）由7变为3，因为计算$c(x,y)+D<em>{y}(x)$比$c(x,y)+D</em>{z}(z)$更小</p>
<p>第三列因为y没有发生变化，所以不用更新</p>
</blockquote>
<p><strong>链路费用变化</strong>：节点检测本地链路费用变化，更新路由信息，重新计算距离向量，如果$DV$改变，通告所有邻居</p>
<p>好消息（变小）传播快</p>
<p>坏消息（变大）传播慢：无穷计数问题</p>
<p><img src="https://s2.loli.net/2022/05/18/IQ7fkYy3dV9sioR.png" alt="image-20220518141719635"></p>
<p><strong>毒性逆转</strong>：如果一个节点（z）到达某目的（x）的最小费用路径是通过某个邻居（y）则通告给该邻居节点到达目的的距离为无穷大</p>
<p><img src="https://s2.loli.net/2022/05/18/h73UcDfndIwPojF.png" alt="image-20220518142241833"></p>
<p><strong>最大度量值</strong>：定义一个最大的有效费用值，超过则表示无穷</p>
<p><img src="https://s2.loli.net/2022/05/18/fV2qRIneaysrG9S.png" alt="image-20220518142735342"></p>
<h1 id="层次路由"><a href="#层次路由" class="headerlink" title="层次路由"></a>层次路由</h1><p>聚合路由器为一个区域：<strong>自治系统$AS$</strong></p>
<p>同一个$AS$内的路由器运行相同的路由协议</p>
<ul>
<li>自制系统内部路由协议</li>
<li>不同自治系统内的路由器可以运行不同的$AS$内部的路由协议</li>
</ul>
<p><strong>网关路由器（gateway router）</strong></p>
<ul>
<li>位于$AS$边缘</li>
<li>通过链路连接其他$AS$的网关路由器</li>
</ul>
<p>转发表由$AS$内部的路由算法与$AS$间路由算法共同配置</p>
<p><img src="https://s2.loli.net/2022/05/18/byQ35RcoKlGCzU8.png" alt="image-20220518145456597"></p>
<h2 id="自治系统间路由"><a href="#自治系统间路由" class="headerlink" title="自治系统间路由"></a>自治系统间路由</h2><p><img src="https://s2.loli.net/2022/05/18/mqZw1pEc2jQbJ6X.png" alt="image-20220518145718662"></p>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/18/FxjnhAwWeBPt76q.png" alt="image-20220518145904876"></p>
<p><img src="https://s2.loli.net/2022/05/18/LQGz6PEwI9CXcWu.png" alt="image-20220518150015646"></p>
<p><strong>热土豆路由</strong>：将分组发送给最近的网关路由器</p>
<p><img src="https://s2.loli.net/2022/05/18/zeCB3ZWky4waM8l.png" alt="image-20220518150127016"></p>
</blockquote>
<h1 id="RIP-协议"><a href="#RIP-协议" class="headerlink" title="$RIP$协议"></a>$RIP$协议</h1><p>（$Routing \space Information \space Protocol$）</p>
<p>$AS$内部路由协议也称为内部网络协议$IGP$</p>
<p><strong>利用距离向量路由算法</strong></p>
<ul>
<li>距离度量：跳步数（max = 15 hops），每条链路一个跳步</li>
<li>每隔30秒，邻居之间交换一次$DV$，成为通告</li>
<li>每次通告：最多25个目的子网</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/18/dyStM586VFXgkYn.png" alt="image-20220518151435282"></p>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/18/VBJnHhid1ctEQAZ.png" alt="image-20220518151656950"></p>
<p>用下一条来实现毒性逆转技术</p>
</blockquote>
<p><strong>链路失效、恢复</strong></p>
<ul>
<li>如果180秒没有收到通告，则邻居/链路失效，经过该邻居的路由不可用，需要重新计算路由</li>
<li>向邻居发送新的通告（如果发生转变）</li>
<li>邻居再一次向外发送通告（如果发生转变）</li>
</ul>
<p><strong>$RIP$路由表的处理</strong></p>
<ul>
<li>利用一个叫做$route-d$的应用层进程来管理</li>
<li>通告报文周期性地通过$UDP$数据报发送</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/18/eWv4azQBIGy2gLf.png" alt="image-20220518152201678"></p>
<h1 id="OSPF-协议"><a href="#OSPF-协议" class="headerlink" title="$OSPF$协议"></a>$OSPF$协议</h1><p>（$Open \space Shortest \space Path \space First$）</p>
<p>开放</p>
<p>采用链路状态路由算法</p>
<ul>
<li>链路状态分组扩散</li>
<li>每个路由器构造完整的网络拓扑图</li>
<li>利用$Dijkstra$算法计算路由</li>
</ul>
<p>$OSPF$通告中每个入口对应一个邻居</p>
<p>$OSPF$在整个$AS$范围泛洪</p>
<ul>
<li>$OSPF$报文直接封装到$IP$数据报中</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li>安全：所有$OSPF$报文可以被认证（预防恶意入侵）</li>
<li>允许使用多条相同费用的路径</li>
<li>对于每条链路，可以针对不同的$TOS$设置多个不同的费用度量（针对希望在这条链路上传输的分组设置低费用）</li>
<li>集成单播路由与多播路由，多播$MOSPF$与$OSPF$利用相同的网络拓扑数据</li>
<li>支持对大规模$AS$分层</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/18/MqwKZD2YUTkdQvh.png" alt="image-20220518153528084"></p>
<p><img src="https://s2.loli.net/2022/05/18/2RkAFmSH4LOVj6x.png" alt="image-20220518153549406"></p>
<p><img src="https://s2.loli.net/2022/05/18/ZUW9PDyHcw3VM8I.png" alt="image-20220518153654002"></p>
<p><img src="https://s2.loli.net/2022/05/18/YEsGkeOdz4PpLU6.png" alt="image-20220518153714817"></p>
<p>（边界路由器可以有多个）</p>
<h1 id="BGP协议"><a href="#BGP协议" class="headerlink" title="BGP协议"></a>BGP协议</h1><h2 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h2><p>边界网关协议（Border Gateway Protocol）是标准域间路由协议</p>
<p>BGP为每个AS提供了一种手段</p>
<ul>
<li>eBGP：从邻居AS获取子网可达信息</li>
<li>iBGP：向所有AS内部路由器传播子网可达信息</li>
<li>基于可达信息与策略，确定到达其他网络的“好路径”</li>
</ul>
<p>容许子网向Internet其余部分通告它的存在</p>
<p><strong>BGP会话</strong>：两个BGP路由器（Peers）交换BGP报文：</p>
<ul>
<li>通告去往不同目的前缀的路径（“路径向量”协议）</li>
<li>报文交换基于半永久的TCP连接</li>
</ul>
<p><strong>BGP报文</strong>：</p>
<ul>
<li>OPEN：与peer建立TCP连接，并认证发送方</li>
<li>UPDATE：通告新路径（或撤销原路径）</li>
<li>KEEPALIVE：再无UPDATE时，保活连接；也用于对OPEN请求的确认</li>
<li>NOTIFICATION：报告先前报文的差错；也被用于关闭连接</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/18/HWmsgItTUNu5OVB.png" alt="image-20220518192305805"></p>
<p><strong>分发路径信息</strong></p>
<p><img src="https://s2.loli.net/2022/05/18/jH36Yq2LItRDMhv.png" alt="image-20220518192516162"></p>
<h2 id="路径属性"><a href="#路径属性" class="headerlink" title="路径属性"></a>路径属性</h2><p>通告的前缀信息包括BGP属性</p>
<ul>
<li>前缀+属性 = “路由”</li>
</ul>
<p>两个重要属性</p>
<ul>
<li>AS-PATH：包含前缀通告所经过的AS序列</li>
<li>NEXT-HOP：开始下一个AS-PATH的路由器接口，指向下一跳AS<ul>
<li>可能从当前AS到下一跳AS存在多条链路</li>
</ul>
</li>
</ul>
<p><img src="https://s2.loli.net/2022/05/18/iNLsyVZGj4Y5cCU.png" alt="image-20220518194939946"></p>
<p>这里从AS3发到AS1，下一跳是3a的接口IP地址</p>
<h2 id="BGP路由选择"><a href="#BGP路由选择" class="headerlink" title="BGP路由选择"></a>BGP路由选择</h2><p>网关路由器收到路由通告后，利用其输入策略决策接受/拒绝该路由（<strong>基于决策路由</strong>）</p>
<p>路由器可能获知到达某目的AS的多条路由，基于一下准则选择：</p>
<ul>
<li>本地偏好值属性：策略决策</li>
<li>最短AS-PATH</li>
<li>最新NEXT-HOP路由器（热土豆路由）</li>
<li>附加准则</li>
</ul>
<blockquote>
<p><img src="https://s2.loli.net/2022/05/18/4MFQSEaZNbOqhc8.png" alt="image-20220518200904751"></p>
<p>提供商网络只期望为客户路由</p>
<p><img src="https://s2.loli.net/2022/05/18/Yq7cV1mxyrNF2wS.png" alt="image-20220518201236334"></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">jianjian</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://mujian.work/2022/05/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%89/">https://mujian.work/2022/05/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://mujian.work" target="_blank">划水摸鱼</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%A1%E7%BD%91/">计网</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/05/14/ql1w5dKJmnY3irH.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/05/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%EF%BC%89/"><img class="prev-cover" src="https://s2.loli.net/2022/05/27/7cHZ2lxTQ9JOrDM.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">计算机网络（数据链路层）</div></div></a></div><div class="next-post pull-right"><a href="/2022/05/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%89/"><img class="next-cover" src="https://s2.loli.net/2022/05/12/BOsxyZXEaImMlLf.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">计算机网络（运输层）</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/05/29/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E5%AE%89%E5%85%A8%EF%BC%89/" title="计算机网络（安全）"><img class="cover" src="https://s2.loli.net/2022/05/29/WNQG5knthEdrLzB.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-29</div><div class="title">计算机网络（安全）</div></div></a></div><div><a href="/2022/06/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E4%BD%99%EF%BC%89/" title="计算机网络（余）"><img class="cover" src="https://s2.loli.net/2022/05/07/qf4e2z9YBmPhV3c.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-06-24</div><div class="title">计算机网络（余）</div></div></a></div><div><a href="/2022/05/10/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%89/" title="计算机网络（运输层）"><img class="cover" src="https://s2.loli.net/2022/05/12/BOsxyZXEaImMlLf.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-10</div><div class="title">计算机网络（运输层）</div></div></a></div><div><a href="/2022/05/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%EF%BC%89/" title="计算机网络（数据链路层）"><img class="cover" src="https://s2.loli.net/2022/05/27/7cHZ2lxTQ9JOrDM.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-24</div><div class="title">计算机网络（数据链路层）</div></div></a></div><div><a href="/2022/05/07/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E5%BA%94%E7%94%A8%E5%B1%82%EF%BC%89/" title="计算机网络（应用层）"><img class="cover" src="https://s2.loli.net/2022/05/07/qf4e2z9YBmPhV3c.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-07</div><div class="title">计算机网络（应用层）</div></div></a></div><div><a href="/2022/04/27/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%EF%BC%88%E6%A6%82%E8%BF%B0%EF%BC%89/" title="计算机网络(概述)"><img class="cover" src="https://s2.loli.net/2022/04/27/jbCIaKLHfQw7uWz.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-04-27</div><div class="title">计算机网络(概述)</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">网络层服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.2.</span> <span class="toc-text">网络层的核心功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%E6%9C%8D%E5%8A%A1%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">网络层服务模型</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%99%9A%E7%94%B5%E8%B7%AF%E7%BD%91%E7%BB%9C"><span class="toc-number">2.</span> <span class="toc-text">虚电路网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E7%94%B5%E8%B7%AF%EF%BC%88-VC-%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">虚电路（$VC$）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#VC-%E7%9A%84%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0"><span class="toc-number">2.2.</span> <span class="toc-text">$VC$的具体实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E7%94%B5%E8%B7%AF%E4%BF%A1%E4%BB%A4%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.3.</span> <span class="toc-text">虚电路信令协议</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8A%A5%E7%BD%91%E7%BB%9C"><span class="toc-number">3.</span> <span class="toc-text">数据报网络</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%8A%A5%E8%BD%AC%E5%8F%91%E8%A1%A8"><span class="toc-number">3.1.</span> <span class="toc-text">数据报转发表</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Internet%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">4.</span> <span class="toc-text">Internet网络层</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ARP%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.</span> <span class="toc-text">ARP地址解析协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IP"><span class="toc-number">6.</span> <span class="toc-text">$IP$</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IP-%E6%95%B0%E6%8D%AE%E6%8A%A5"><span class="toc-number">6.1.</span> <span class="toc-text">$IP$数据报</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F"><span class="toc-number">6.1.1.</span> <span class="toc-text">格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP%E5%88%86%E7%89%87"><span class="toc-number">6.1.2.</span> <span class="toc-text">$IP分片$</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IP-%E7%BC%96%E5%9D%80"><span class="toc-number">6.2.</span> <span class="toc-text">$IP$编址</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%89%E7%B1%BB-IP-%E5%9C%B0%E5%9D%80"><span class="toc-number">6.3.</span> <span class="toc-text">有类$IP$地址</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AD%90%E7%BD%91%E5%88%92%E5%88%86%E4%B8%8E%E5%AD%90%E7%BD%91%E6%8E%A9%E7%A0%81"><span class="toc-number">7.</span> <span class="toc-text">子网划分与子网掩码</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#CIDR-%E4%B8%8E%E8%B7%AF%E7%94%B1%E8%81%9A%E5%90%88"><span class="toc-number">8.</span> <span class="toc-text">$CIDR$与路由聚合</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%9C%B0%E5%9D%80%E8%BD%AC%E6%8D%A2-NAT"><span class="toc-number">9.</span> <span class="toc-text">网络地址转换$NAT$</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%9C%BA"><span class="toc-number">9.1.</span> <span class="toc-text">动机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0"><span class="toc-number">9.2.</span> <span class="toc-text">实现</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NAT-%E7%A9%BF%E9%80%8F%E9%97%AE%E9%A2%98"><span class="toc-number">9.3.</span> <span class="toc-text">$NAT$穿透问题</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ICMP"><span class="toc-number">10.</span> <span class="toc-text">$ICMP$</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E7%A7%8D%E7%B1%BB"><span class="toc-number">10.1.</span> <span class="toc-text">报文种类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%A5%E6%96%87%E6%A0%BC%E5%BC%8F"><span class="toc-number">10.2.</span> <span class="toc-text">报文格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%AE%E9%94%99%E6%8A%A5%E5%91%8A%E6%8A%A5%E6%96%87%E6%95%B0%E6%8D%AE%E5%B0%81%E8%A3%85"><span class="toc-number">10.3.</span> <span class="toc-text">差错报告报文数据封装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">10.4.</span> <span class="toc-text">应用</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#IPv6"><span class="toc-number">11.</span> <span class="toc-text">$IPv6$</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%9C%BA-1"><span class="toc-number">11.1.</span> <span class="toc-text">动机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%BC%E5%BC%8F-1"><span class="toc-number">11.2.</span> <span class="toc-text">格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%94%B9%E5%8F%98"><span class="toc-number">11.3.</span> <span class="toc-text">改变</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9D%80%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.4.</span> <span class="toc-text">基本地址类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%B8%A1"><span class="toc-number">11.5.</span> <span class="toc-text">过渡</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="toc-number">12.</span> <span class="toc-text">路由算法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">12.1.</span> <span class="toc-text">分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E7%8A%B6%E6%80%81%E8%B7%AF%E7%94%B1%E7%AE%97%E6%B3%95"><span class="toc-number">12.2.</span> <span class="toc-text">链路状态路由算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%9D%E7%A6%BB%E5%90%91%E9%87%8F%E7%AE%97%E6%B3%95"><span class="toc-number">12.3.</span> <span class="toc-text">距离向量算法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B1%82%E6%AC%A1%E8%B7%AF%E7%94%B1"><span class="toc-number">13.</span> <span class="toc-text">层次路由</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E6%B2%BB%E7%B3%BB%E7%BB%9F%E9%97%B4%E8%B7%AF%E7%94%B1"><span class="toc-number">13.1.</span> <span class="toc-text">自治系统间路由</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RIP-%E5%8D%8F%E8%AE%AE"><span class="toc-number">14.</span> <span class="toc-text">$RIP$协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#OSPF-%E5%8D%8F%E8%AE%AE"><span class="toc-number">15.</span> <span class="toc-text">$OSPF$协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BGP%E5%8D%8F%E8%AE%AE"><span class="toc-number">16.</span> <span class="toc-text">BGP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E7%A1%80"><span class="toc-number">16.1.</span> <span class="toc-text">基础</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%B1%9E%E6%80%A7"><span class="toc-number">16.2.</span> <span class="toc-text">路径属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BGP%E8%B7%AF%E7%94%B1%E9%80%89%E6%8B%A9"><span class="toc-number">16.3.</span> <span class="toc-text">BGP路由选择</span></a></li></ol></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By jianjian</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Oh, year!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>